# Builder stage
FROM registry.ocp4.example.com:8443/ubi9/nodejs-22:1 AS builder

# Switch to root to ensure permissions
USER root

# Copy source files
COPY . /opt/app-root/src/

# Set working directory
WORKDIR /opt/app-root/src

# Install dependencies and build
RUN npm install && npm run build

# Runtime stage
FROM image-registry.openshift-image-registry.svc:5000/openshift/nginx:1.16-el8

# Copy nginx configuration
COPY nginx.conf /etc/nginx/nginx.conf

# Copy built application from builder stage
COPY --from=builder /opt/app-root/src/dist /usr/share/nginx/html

# Expose port
EXPOSE 8080

# Start nginx
CMD ["nginx", "-g", "daemon off;"]
