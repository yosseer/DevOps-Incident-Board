apiVersion: v1
kind: ConfigMap
metadata:
  name: postgresql-config
  namespace: devops-incident-board-app
  labels:
    app: postgresql
data:
  # Database configuration
  DB_NAME: beeper_db
  DB_HOST: postgresql
  DB_PORT: "5432"
  # PostgreSQL environment variables
  POSTGRES_INITDB_ARGS: "-c max_connections=200 -c shared_buffers=256MB"
  # Init SQL script to create application user and database
  init.sql: |
    -- Create application database
    CREATE DATABASE beeper_db;
    
    -- Create application user
    CREATE USER beeper WITH PASSWORD 'beeper_secure_password_123';
    
    -- Grant permissions
    GRANT ALL PRIVILEGES ON DATABASE beeper_db TO devops-incident-board-app;
    
    -- Connect to the database and grant schema permissions
    \c beeper_db
    GRANT ALL ON SCHEMA public TO devops-incident-board-app;
    ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO devops-incident-board-app;
    ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO devops-incident-board-app;
